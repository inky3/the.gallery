---
import Main from '../layouts/Main.astro';
import Card from '../components/Card.astro';

const hero = {
  head: "Projects",
  description: "Explore my Website that I created myself."
};

const filters = [
  { key: "all", label: "All" },
  { key: "coding", label: "Coding" },
  { key: "ux/ui-design", label: "UX/UI Design" },
];

const items = [
  {
    title: "The Memories Website",
    image: "/img/project/thememories.jpg",
    category: "coding",
    intro: "พอร์ตโฟลิโอเว็บไซต์แสดงผลงาน ที่มี concept เกี่ยวกับความทรงจำ พร้อมโทนสีส้มฟิลม์ววินเทจ โดยโปรเจคนี้ได้ถูกเขียนขึ้นมาโดยคนเดียวทั้งหมด",
    href: "projects/the-memories"
  },
  {
    title: "Tanawat Work Website",
    image: "/img/project/tanawatwork.jpg",
    category: ["coding", "ux/ui-design"],
    intro: "พอร์ตโฟลิโอเว็บไซต์แสดงผลงาน ที่มี concept เกี่ยวกับ Warhammer เผ่า Necron โดยโปรเจคนี้ได้ถูกเขียนและออกแบบขึ้นมาโดยคนเดียวทั้งหมด",
    href: "projects/tanawat-work"
  },
  {
    title: "Good Health",
    image: "/img/project/goodhealth.jpg",
    category: "ux/ui-design",
    intro: " Project นี้ เป็นวิจัยเว็ปไซต์เกี่ยวกับการรวบรวมข้อมูลอาหารโดยเล็งไปให้ผู้ใช้ที่เป็นโรคเบาหวานที่ถูกทำขึ้นใน Figma",
    href: "projects/goodhealth"
  },
  {
    title: "Mad Pizza",
    image: "/img/project/madpizza.jpg",
    category: "ux/ui-design",
    intro: "Project นี้ เป็นการออแบบเมนูให้กับร้านพิซซ่า Mad Pizza ที่เน้นโทนสีแดงส้ม เพื่อให้เข้ากับบรรยากาศร้าน โดยโปรเจคนี้ได้ถูกทำขึ้นใน Figma",
    href: "projects/madpizza"
  },
  {
    title: "GBTP3D",
    image: "/img/project/GBTP3D.jpg",
    category: "ux/ui-design",
    intro: "Project นี้ ผมได้เป็นส่วนร่วมในการออกแบบเว็บไซต์สำหรับบริการพิมพ์งาน 3 มิติ ที่เน้นโทนสีฟ้า-ขาว เพื่อให้ดูสะอาดตาและน่าเชื่อถือ โดยโปรเจคนี้ได้ถูกทำขึ้นใน Figma",
    href: "projects/gbpt3d"
  }
];
---

<Main head={hero.head} description={hero.description}>
  <section class="py-5">
    <div class="container">
      <!-- HEADER + FILTER PILLS -->
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
        <h2 class="mb-2">Projects</h2>

        <div class="pill-filter" id="projectFilterNav">
          {filters.map((f, i) => (
            <button
              type="button"
              class={`pill-btn ${i === 0 ? 'active' : ''}`}
              data-filter={f.key}
            >
              {f.label}
            </button>
          ))}
        </div>
      </div>

      <!-- ONE mobile-only button (global) -->
      <div class="text-center mb-4">
        <button id="toggleDescriptions" class="desc-btn" type="button">
          View Description
        </button>
      </div>

      <!-- GALLERY -->
      <div class="row g-4" id="gallery">
        {items.map((item) => (
          <Card
            title={item.title}
            image={item.image}
            category={item.category}
            intro={item.intro}
            href={item.href}
          />
        ))}
      </div>
    </div>
  </section>

  <script>
    // run ONLY in browser
    window.addEventListener("DOMContentLoaded", () => {
      const nav = document.getElementById("projectFilterNav");
      const toggleBtn = document.getElementById("toggleDescriptions");
      const cards = Array.from(document.querySelectorAll(".gallery-card"));

      // -------- FILTER LOGIC --------
      if (nav && cards.length) {
        nav.addEventListener("click", (event) => {
          const target = event.target;
          if (!target || target.tagName !== "BUTTON") return;

          // active UI
          nav.querySelectorAll("button").forEach((btn) => btn.classList.remove("active"));
          target.classList.add("active");

          const filter = (target.dataset.filter || "all").toLowerCase();

          cards.forEach((card) => {
            const col = card.closest(".gallery-col");
            if (!col) return;

            // data-category may be: "coding" or "coding,ux/ui-design"
            const raw = (card.dataset.category || "").toLowerCase();
            const list = raw.split(",").map((x) => x.trim()).filter(Boolean);

            const match = filter === "all" || list.includes(filter);
            col.style.display = match ? "" : "none";
          });
        });
      }

      // -------- MOBILE "VIEW DESCRIPTION" (one button) --------
      if (toggleBtn) {
        // show/hide only if screen < 770
        const applyVisibility = () => {
          if (window.innerWidth <= 770) {
            toggleBtn.style.display = "inline-block";
          } else {
            toggleBtn.style.display = "none";
            // also reset cards on desktop
            document.querySelectorAll(".card-figure.show-info").forEach((fig) => {
              fig.classList.remove("show-info");
            });
            toggleBtn.classList.remove("active");
            toggleBtn.textContent = "View Description";
          }
        };

        applyVisibility();
        window.addEventListener("resize", applyVisibility);

        toggleBtn.addEventListener("click", () => {
          const willShow = !toggleBtn.classList.contains("active");
          toggleBtn.classList.toggle("active", willShow);
          toggleBtn.textContent = willShow ? "Hide Description" : "View Description";

          document.querySelectorAll(".card-figure").forEach((fig) => {
            if (willShow) fig.classList.add("show-info");
            else fig.classList.remove("show-info");
          });
        });
      }
    });
  </script>

  <style>
    /* --- FILTER PILLS --- */
    .pill-filter {
      display: inline-flex;
      gap: .35rem;
      background: #f6f7f7;
      border-radius: 999px;
      padding: 0.25rem;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.04);
    }
    .pill-btn {
      border: none;
      background: transparent;
      color: #333;
      font-weight: 500;
      padding: 0.45rem 1.2rem;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.25s ease;
      white-space: nowrap;
    }
    .pill-btn.active {
      background: #0f6657;
      color: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,.15);
    }
    .pill-btn:hover:not(.active) {
      background: rgba(0,0,0,.05);
    }

    /* --- MOBILE VIEW DESCRIPTION BTN --- */
    .desc-btn {
      background: #f5f5f5;
      border: 1px solid rgba(0,0,0,0.1);
      color: #333;
      border-radius: 999px;
      padding: 0.5rem 1.25rem;
      font-weight: 500;
      transition: all 0.25s ease;
      display: none; /* default hidden, JS will show < 770px */
    }
    .desc-btn.active {
      background: #0f6657;
      color: #fff;
      border-color: #0f6657;
    }
  </style>
</Main>
