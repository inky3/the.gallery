---
import Main from "../layouts/Main.astro";
import Card from "../components/Card.astro";

const hero = {
  head: "The.Gallery",
  description: "Exploring our highlighted work"
};
---

<Main head={hero.head} description={hero.description}>
  <section class="py-5">
    <div class="container">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <h2 class="mb-3 mb-md-0">From Our Gallery</h2>
        <!-- Filter Nav -->
        <ul class="nav navline flex-wrap justify-content-center justify-content-md-start" id="filterNav">
          <li class="nav-item">
            <a class="nav-link active" data-filter="all" href="#">Highlight</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-filter="photography" href="#">Photography</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-filter="terrarium" href="#">Terrarium</a>
          </li>
          <div class="indicator d-none d-md-block"></div>
        </ul>
      </div>

      <!-- Gallery Cards -->
      <div class="container overflow-hidden text-center">
        <div class="row g-4 position-relative" id="gallery">
          <Card title="Alone in the Grey" image="img/poster/alone-in-the-grey.png" category="poster" href="#" />
          <Card title="Casa Lapin Coffee Bean" image="img/photography/casa-lapin.jpg" category="photography" href="/the.gallery/gallery/photography" />
          <Card title="'Duck'" image="img/terrarium/Duck.jpg" category="terrarium" href="/the.gallery/gallery/terrarium" />
          <Card title="Senimar Poster" image="img/poster/Brand-Identity-and-Typography.png" category="poster" href="/the.gallery/gallery/poster/brand-identity-and-typography" />
          <Card title="Porsche956" image="img/photography/porsche956/IMG_9504.JPG" category="photography" href="/the.gallery/gallery/photography/porsche956" />
          <Card title="Le Mans" image="img/book/le-mans-book.jpg" category="book" href="#" />
          <Card title="Creativity of Aerodynamic" image="img/book/creativity-of-aerodynamic.jpg" category="book" href="#" />
        </div>
      </div>
    </div>
  </section>

  <!-- Page-only JS (no Bootstrap here) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Filter logic
      const filterNav = document.getElementById("filterNav");
      const cards = document.querySelectorAll(".gallery-card");
      if (filterNav && cards.length) {
        filterNav.addEventListener("click", (e) => {
          const el = e.target;
          if (!(el instanceof HTMLElement) || el.tagName !== "A") return;
          e.preventDefault();

          // Active state
          filterNav.querySelectorAll("a").forEach((link) => link.classList.remove("active"));
          el.classList.add("active");

          const filter = el.getAttribute("data-filter");
          cards.forEach((card) => {
            const cat = card.dataset.category;
            if (filter === "all" || cat === filter) card.classList.remove("hide");
            else card.classList.add("hide");
          });
        });
      }

      // Moving underline indicator (guarded)
      const navLinks = document.querySelectorAll(".navline a");
      const indicator = document.querySelector(".indicator");
      if (indicator && navLinks.length) {
        const moveIndicator = (link) => {
          const linkRect = link.getBoundingClientRect();
          const parentRect = link.closest(".navline").getBoundingClientRect();
          indicator.style.width = `${linkRect.width}px`;
          indicator.style.left = `${linkRect.left - parentRect.left}px`;
        };
        const active = document.querySelector(".navline a.active");
        if (active) moveIndicator(active);
        navLinks.forEach((link) =>
          link.addEventListener("click", (e) => {
            navLinks.forEach((l) => l.classList.remove("active"));
            e.currentTarget.classList.add("active");
            moveIndicator(e.currentTarget);
          })
        );
        window.addEventListener("resize", () => {
          const current = document.querySelector(".navline a.active");
          if (current) moveIndicator(current);
        });
      }
    });
  </script>

  <style>
    /* Animation for slide effect */
    .gallery-card { transition: transform 0.4s ease, opacity 0.4s ease; }
    .hide { opacity: 0; transform: translateX(-50px); pointer-events: none; position: absolute; }

    /* Filter nav visuals */
    .navline {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;
      position: relative; padding: 0.3rem 0; border-bottom: 2px solid #555; margin: 0;
    }
    @media (max-width: 767.98px) { .navline { justify-content: center; } }
    .navline a { text-decoration: none; font-size: 1rem; color: #888; position: relative; padding-bottom: .5rem; transition: color .3s; }
    .navline a.active { color: #000; font-weight: 600; }
    .indicator { position: absolute; bottom: -2px; height: 2px; background: #000; transition: all .3s; }
    .indicator::before {
      content: ""; position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #000;
    }
  </style>
</Main>
