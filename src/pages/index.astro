---
import Main from "../layouts/Main.astro";
import Card from "../components/Card.astro";

const hero = {
  head: "The.Gallery",
  description: "Exploring our highlighted work"
};
---

<Main head={hero.head} description={hero.description}>
  <section class="py-5">
    <div class="container">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <h2 class="mb-3 mb-md-0">From Our Gallery</h2>

        <!-- Filter Nav -->
        <ul class="nav navline flex-wrap justify-content-center justify-content-md-start" id="filterNav">
          <li class="nav-item">
            <a class="nav-link active" data-filter="all" >Highlight</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-filter="photography" >Photography</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-filter="terrarium" >Terrarium</a>
          </li>

          <!-- moving underline -->
          <div class="indicator d-none d-md-block"></div>
        </ul>
      </div>

      <!-- ✅ mobile-only “show description” button -->
      <!-- Mobile-only View Description Button -->
      <div class="text-center mb-4">
        <button id="toggleDescriptions" class="desc-btn" type="button">
          View Description
        </button>
      </div>

      <!-- Gallery Cards -->
      <div class="container overflow-hidden text-center">
        <div class="row g-4 position-relative" id="gallery">
          <Card
            title="Alone in the Grey"
            image="img/poster/alone-in-the-grey.png"
            category="poster"
            intro="ภาพโปสเตอร์ Aline in the grey ที่แสดงให้เห็นถึงความเหงาในยามเย็น"
            href="/the.gallery/gallery/poster/alone-in-the-grey"
          />
          <Card
            title="Casa Lapin Coffee Bean"
            image="img/photography/casa-lapin.jpg"
            category="photography"
            intro="Packaged เมล็ดกาแฟ คาเฟ่ Casa Lapin โทนอุ่น แสงนุ่ม"
          />
          <Card
            title="Duck"
            image="img/terrarium/Duck.jpg"
            category="terrarium"
            intro="สวนขวดแก้วมินิ พร้อมตุ๊กตาเป็ดน้อย"
            href="/the.gallery/gallery/terrarium"
          />
          <Card
            title="Alley 7"
            image="/img/poster/Alley7.png"
            category="poster"
            intro="โปสเตอร์ Alley 7 ที่แสดงถึงซอยเล็กๆ ณ Siam Square"
            href="/the.gallery/gallery/poster/alley7"
          />
          <Card
            title="Porsche 956"
            image="img/photography/porsche956/IMG_9504.JPG"
            category="photography"
            intro="ภาพ Collection ชุดรถแข่ง Le Mans Porsche 956"
            href="/the.gallery/gallery/photography/porsche956"
          />
          <Card
            title="Le Mans"
            image="img/book/le-mans-book.jpg"
            category="book"
            intro="แมกซีนหนังสือปกแข็งจำลองสำหรับการแข่งรถ Endurance Racing"
          />
          <Card
            title="Creativity of Aerodynamic"
            image="img/book/creativity-of-aerodynamic.jpg"
            category="book"
            intro="หนังสือทดลองออกแบบเลย์เอาต์เกี่ยวกับหลักการอากาศพลศาสตร์"
          />
        </div>
      </div>
    </div>
  </section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    /* ====== FILTER ====== */
    const filterNav = document.getElementById("filterNav");
    const cards = document.querySelectorAll(".gallery-card");

    if (filterNav && cards.length) {
      filterNav.addEventListener("click", (e) => {
        const el = e.target;
        if (!(el instanceof HTMLElement) || el.tagName !== "A") return;
        e.preventDefault();

        // set active
        filterNav.querySelectorAll("a").forEach((link) => link.classList.remove("active"));
        el.classList.add("active");

        const filter = (el.getAttribute("data-filter") || "all").toLowerCase();

        cards.forEach((card) => {
          const cat = (card.dataset.category || "").toLowerCase();
          const col = card.closest(".gallery-col");
          const match = filter === "all" || cat === filter;
          if (col) col.style.display = match ? "" : "none";
        });
      });
    }

    /* ====== MOVING INDICATOR ====== */
    const navLinks = document.querySelectorAll(".navline a");
    const indicator = document.querySelector(".indicator");
    if (indicator && navLinks.length) {
      const moveIndicator = (link) => {
        if (!link) return;
        const navline = link.closest(".navline");
        if (!navline) return;

        const linkRect = link.getBoundingClientRect();
        const parentRect = navline.getBoundingClientRect();
        indicator.style.width = linkRect.width + "px";
        indicator.style.left = (linkRect.left - parentRect.left) + "px";
      };

      const active = document.querySelector(".navline a.active");
      if (active) moveIndicator(active);

      navLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          navLinks.forEach((l) => l.classList.remove("active"));
          const target = e.currentTarget;
          if (target && target.classList) {
            target.classList.add("active");
            moveIndicator(target);
          }
        });
      });

      window.addEventListener("resize", () => {
        const current = document.querySelector(".navline a.active");
        if (current) moveIndicator(current);
      });
    }

    /* ====== MOBILE “SHOW DESCRIPTIONS” TOGGLE ====== */
    const btn = document.getElementById("toggleDescriptions");
    if (btn) {
      const mq = window.matchMedia("(max-width: 770px)");

      function setBtnState() {
        btn.style.display = mq.matches ? "inline-block" : "none";
        // If leaving mobile mode, reset descriptions
        if (!mq.matches) {
          btn.classList.remove("active");
          btn.textContent = "View Description";
          document.querySelectorAll(".card-figure").forEach((fig) => {
            fig.classList.remove("show-info");
          });
        }
      }

      // initial + reactive
      setBtnState();
      if (mq.addEventListener) {
        mq.addEventListener("change", setBtnState);
      } else {
        // Safari fallback
        mq.addListener(setBtnState);
      }

      btn.addEventListener("click", () => {
        const willShow = !btn.classList.contains("active");
        btn.classList.toggle("active", willShow);
        btn.textContent = willShow ? "Hide Description" : "View Description";
        document.querySelectorAll(".card-figure").forEach((fig) => {
          fig.classList.toggle("show-info", willShow);
        });
      });
    }
  });
</script>


  <style>
    .gallery-card { transition: transform 0.4s ease, opacity 0.4s ease; }

    .navline {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem;
      position: relative; padding: 0.3rem 0; border-bottom: 2px solid #555; margin: 0;
    }
    @media (max-width: 767.98px) { .navline { justify-content: center; } }
    .navline a { text-decoration: none; font-size: 1rem; color: #888; position: relative; padding-bottom: .5rem; transition: color .3s; }
    .navline a.active { color: #000; font-weight: 600; }
    .indicator { position: absolute; bottom: -2px; height: 2px; background: #000; transition: all .3s; }
    .indicator::before {
      content: ""; position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #000;
    }

    .desc-btn {
      display: none;
      background: #f5f5f5;
      border: 1px solid rgba(0,0,0,0.1);
      color: #333;
      border-radius: 999px;
      padding: 0.5rem 1.25rem;
      font-weight: 500;
      transition: all 0.25s ease;
    }
    .desc-btn.active {
      background: #0f6657;
      color: #fff;
      border-color: #0f6657;
    }

    /* Show only on phones/small tablets */
    @media (max-width: 770px) {
      .desc-btn { display: inline-block; }
    }
  </style>
</Main>
