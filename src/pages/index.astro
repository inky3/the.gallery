---
import Main from "../layouts/Main.astro";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import Hero from "../components/Hero.astro";
import FeaturedShowcase from "../components/FeaturedShowcase.astro";

// BASE URL helper for local + GitHub Pages safety
const base = import.meta.env.BASE_URL || "/";
const href = (p = "/") => `${base}${String(p).replace(/^\/+/, "")}`;

// Page copy
const hero = {
  title: "A Personal Gallery of Work & Memory",
  lead: "A quiet space for design, imagery, and exploration.",
};

const caps = [
  { h: "UX / UI",   p: "Accessible, component-driven design systems." },
  { h: "Front-End", p: "Astro & React builds with clean CSS utilities." },
  { h: "Graphics",  p: "Visual identities and product imagery." }
];
---

<Main head="THE.GALLERY — Home" description={hero.lead}>
  <Fragment slot="nav"><Nav /></Fragment>

  <!-- MUSEUM HERO -->
  <Hero
    images={[
      "/img/photography/porsche956/IMG_9504.jpg",
      "/img/photography/porsche956/IMG_9496.jpg",
      "/img/photography/porsche956/IMG_9531.jpg",
    ]}
    title={hero.title}
    label="Studio Archive"
    lead={hero.lead}
    actions={[
      { label: "Explore Gallery", href: href("projects") },
      { label: "About the Artist", href: href("about") },
    ]}
  />

  <!-- AREAS OF FOCUS -->
  <section class="band-soft section" data-anim>
    <div class="container-narrow">
      <h2 class="section-headline">Areas of Focus</h2>
      <p class="section-subhead">Core disciplines I design and build within.</p>

      <div class="grid-3">
        {caps.map((c) => (
          <article class="surface tile">
            <h3>{c.h}</h3>
            <p>{c.p}</p>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- FEATURED WORK -->
  <section class="band-dark section" data-anim>
    <div class="container-narrow">
      <h2 class="section-headline">Featured Work</h2>
      <p class="section-subhead">Editorial highlights with a slow, cinematic switch.</p>

      <FeaturedShowcase
        id="featured-showcase"
        items={[
          {
            title: "Good Health — Diabetes-friendly UX",
            meta: "UX/UI • Health",
            intro: "Research-led IA and UI kit for clear, trustworthy health flows.",
            image: "/img/project/goodhealth/index.jpg",
            href: "/projects/goodhealth",
          },
          {
            title: "Mad Pizza — Digital Menu (iPad)",
            meta: "UX/UI • Restaurant",
            intro: "Thumb-friendly ordering, fast category switching, micro-interactions.",
            image: "/img/project/madpizza.jpg",
            href: "/projects/madpizza",
          },
        ]}
      />
    </div>
  </section>

  <!-- CTA -->
  <section class="container-narrow section" data-anim>
    <div class="surface cta">
      <div>
        <h3 class="h2" style="margin:0 0 .4rem">Like what you see?</h3>
        <p class="lead" style="margin:0">Let’s collaborate on a clean, accessible interface.</p>
      </div>
      <a class="btn" href={href("about")}>Get in touch</a>
    </div>
  </section>

  <Fragment slot="footer"><Footer /></Fragment>

  <!-- Slider logic -->
  <script is:inline>
    (() => {
      const root = document.getElementById('featured-showcase');
      if (!root) return;

      const viewport = root.querySelector('[data-stack]');
      const slides = Array.from(root.querySelectorAll('.fscope__slide'));
      const dots   = Array.from(root.querySelectorAll('.fscope__dot'));
      const prev   = root.querySelector('[data-prev]');
      const next   = root.querySelector('[data-next]');

      if (!slides.length || !viewport) return;

      let i = 0, timer = null;
      const AUTOPLAY = true;
      const INTERVAL = 7000;

      const setHeight = (el) => { if (el) viewport.style.height = el.offsetHeight + 'px'; };
      const active = () => slides[i];

      const go = (n) => {
        const from = slides[i];
        i = (n + slides.length) % slides.length;
        const to = slides[i];
        if (from === to) return;

        from.classList.remove('is-active');
        to.classList.add('is-active');

        dots.forEach((d, idx) => {
          const on = idx === i;
          d.classList.toggle('is-active', on);
          d.setAttribute('aria-selected', on ? 'true' : 'false');
        });

        setHeight(to);
      };

      requestAnimationFrame(() => setHeight(active()));

      prev?.addEventListener('click', () => go(i - 1));
      next?.addEventListener('click', () => go(i + 1));
      dots.forEach((d, idx) => d.addEventListener('click', () => go(idx)));

      const start = () => { if (!timer && AUTOPLAY) timer = setInterval(() => go(i + 1), INTERVAL); };
      const stop  = () => { clearInterval(timer); timer = null; };

      start();
      root.addEventListener('mouseenter', stop);
      root.addEventListener('mouseleave', start);
    })();
  </script>

  <!-- Reveal [data-anim] sections when they enter the viewport -->
  <script is:inline>
    (() => {
      const els = Array.from(document.querySelectorAll('[data-anim]'));
      if (!els.length) return;

      const show = (el) => el.classList.add('is-inview');

      if ('IntersectionObserver' in window) {
        const io = new IntersectionObserver((entries) => {
          entries.forEach(e => {
            if (e.isIntersecting) {
              show(e.target);
              io.unobserve(e.target);
            }
          });
        }, { threshold: 0.15, rootMargin: '0px 0px -10% 0px' });

        els.forEach(el => io.observe(el));
      } else {
        els.forEach(show); // no IO support → just show
      }
    })();
  </script>

  <!-- Minimal global styles for the reveal -->
  <style is:global>
    [data-anim]{
      opacity: 0;
      transform: translateY(16px);
      transition: opacity .4s ease, transform .4s ease;
    }
    [data-anim].is-inview{
      opacity: 1;
      transform: none;
    }
    @media (prefers-reduced-motion: reduce){
      [data-anim]{ opacity:1 !important; transform:none !important; }
    }
    /* No-JS safeguard */
    noscript [data-anim]{ opacity:1; transform:none; }
  </style>
</Main>
