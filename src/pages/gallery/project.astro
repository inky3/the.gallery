---
import Main from '../../layouts/Main.astro';

const hero = {
  head: 'Poster Gallery',
  description: 'Explore our curated collection of stunning posters.'
};

/* BASE_URL-safe helper (works locally and on GitHub Pages) */
const base = import.meta.env.BASE_URL || '/';
const url  = (p = '/') => `${base}${String(p).replace(/^\/+/, '')}`;

/* Catalog */
const posters = [
  {
    title: 'The Memories Website',
    image: '/img/project/thememories.jpg',
    href: 'https://inky3.github.io/Memories-of-G',
    category: 'Coding',
  },
  {
    title: 'Wanawat Work Website',
    image: '/img/project/tanawatwork.jpg',
    href: 'https://inky3.github.io/the-work-of-tanawat',
    category: ['Coding', 'UX/UI-Design'],
  },
  {
    title: 'Good Health',
    image: '/img/project/goodhealth.jpg',
    href: 'https://www.figma.com/proto/LmXawaOlg1a0YjpFD2dgxO/Good-Health-PC?page-id=0%3A1&node-id=2151-2834&viewport=1268%2C222%2C0.16&t=xKEa81Rn4wNwnEgT-1&scaling=scale-down&content-scaling=fixed&starting-point-node-id=2132%3A1714',
    // NOTE: was "catagory" — fixed to "category"
    category: 'UX/UI-Design',
  },
  {
    title: 'MAD PIZZA',
    image: '/img/project/madpizza.jpg',
    href: 'https://www.figma.com/proto/XArrul0wbneI0hyZP4mntO/Madpizza?page-id=0%3A1&node-id=1-5&p=f&viewport=210%2C143%2C0.17&t=1VNQwdh78BC66g6O-1&scaling=scale-down&content-scaling=fixed&starting-point-node-id=1%3A5',
    // NOTE: was "catagory" — fixed to "category"
    category: 'UX/UI-Design',
  }
];

/* Filter tabs */
const tabs = ['All', 'Coding', 'UX/UI-Design'];

/* Helper: normalize a card’s categories to a comma-joined string */
const catString = (c) =>
  Array.isArray(c) ? c.join(',') : (c ?? '');
---

<Main head={hero.head} description={hero.description}>
  <!-- Toggle -->
  <div class="container mb-4">
    <div class="view-toggle" role="tablist" aria-label="Choose category">
      {tabs.map((t, i) => (
        <button
          class={`toggle-btn ${i === 0 ? 'is-active' : ''}`}
          role="tab"
          aria-selected={i === 0 ? 'true' : 'false'}
          data-category={t}
        >
          {t}
        </button>
      ))}
    </div>
  </div>

  <!-- Grid -->
  <section id="grid-posters" class="container" aria-label="Poster items">
    <div class="row g-4">
      {posters.map((p) => (
        <div class="col-12 col-sm-6 col-lg-4">
          <a class="card-link" href={p.href} target="_blank" rel="noreferrer">
            <figure
              class="single-tile position-relative"
              data-category={catString(p.category)}
              tabindex="0"
              aria-label={`Open ${p.title}`}
            >
              <img
                src={url(p.image)}
                alt={p.title}
                loading="lazy"
                decoding="async"
                width="960"
                height="960"
                style="display:block;width:100%;height:auto;"
              />
              <div class="label-wrap" aria-hidden="true">
                <div class="label-pill"><span class="label-text">{p.title}</span></div>
              </div>
            </figure>
          </a>
        </div>
      ))}
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btns  = document.querySelectorAll('.toggle-btn');
      const tiles = document.querySelectorAll('#grid-posters .single-tile');

      const applyFilter = (cat) => {
        const want = (cat || 'All').toLowerCase();
        tiles.forEach(tile => {
          const raw = tile.getAttribute('data-category') || '';
          const list = raw.split(',').map(s => s.trim().toLowerCase()).filter(Boolean);
          const match = (want === 'all') || list.includes(want);
          tile.closest('.col-12').style.display = match ? '' : 'none';
        });
      };

      btns.forEach((b) => {
        b.addEventListener('click', () => {
          btns.forEach(x => { x.classList.remove('is-active'); x.setAttribute('aria-selected','false'); });
          b.classList.add('is-active'); b.setAttribute('aria-selected','true');
          applyFilter(b.dataset.category);
        });
      });

      applyFilter('All');
    });
  </script>

  <style>
    /* Toggle */
    .view-toggle {
      display: inline-flex; gap: 6px; padding: 4px;
      background: #f2f4f5; border-radius: 999px; border: 1px solid rgba(0,0,0,.06);
    }
    .toggle-btn {
      appearance: none; border: 0; background: transparent; padding: .4rem .85rem;
      border-radius: 999px; cursor: pointer; color: #333; font-weight: 500;
      transition: background .18s ease, color .18s ease;
    }
    .toggle-btn.is-active { background: #fff; color: #0b6b53; box-shadow: 0 1px 2px rgba(0,0,0,.05); }

    /* Cards */
    .card-link { text-decoration: none; }
    .single-tile {
      margin: 0; background: #fff; border: 1px solid rgba(0,0,0,.08);
      border-radius: 12px; overflow: hidden; cursor: pointer;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .single-tile:hover {
      transform: translateY(-2px);
      border-color: rgba(0,0,0,.12);
      box-shadow: 0 6px 16px rgba(0,0,0,.10);
    }
    .single-tile img { display:block; width:100%; height:auto; aspect-ratio: 4/3; object-fit: cover; }

    /* Pill label */
    .label-wrap {
      position: absolute; left: 0; right: 0; bottom: 20px;
      display: grid; place-items: center; pointer-events: none;
    }
    .label-pill {
      max-width: 86%;
      background: rgba(0,0,0,.66);
      color: #f1f1f1;
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 999px;
      padding: .65rem 1.1rem;
      transform: translateY(12px);
      opacity: .92;
      transition: transform .22s ease, opacity .22s ease, box-shadow .22s ease, border-color .22s ease;
      backdrop-filter: saturate(120%) blur(4px);
    }
    .single-tile:hover .label-pill {
      transform: translateY(0);
      opacity: 1;
      box-shadow: 0 6px 16px rgba(0,0,0,.22);
      border-color: rgba(255,255,255,.55);
    }
    .label-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    @media (max-width: 575.98px) {
      .single-tile img { aspect-ratio: 1 / 1; }
    }
  </style>
</Main>
