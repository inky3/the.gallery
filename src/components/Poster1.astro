---
/**
 * Poster1.astro â€” flexible poster detail block with AVIF/WebP fallbacks
 * Props:
 *  - img: string (relative or absolute). Fallback: /img/blank.jpg
 *  - name?: string
 *  - idea?: string
 *  - date?: string
 */
const { img, name = "", idea = "", date = "" } = Astro.props;

// GitHub Pages / base-path safe resolver
const base = import.meta.env.BASE_URL || "/";
const resolve = (p?: string) =>
  p && /^https?:\/\//i.test(p) ? p : `${base}${String(p || "img/blank.jpg").replace(/^\/+/, "")}`;

// Build format candidates: foo.jpg -> foo.avif / foo.webp
const deriveFormats = (p?: string) => {
  const fallback = resolve(p);
  const noExt = fallback.replace(/\.(avif|webp|jpe?g|png)$/i, "");
  return {
    avif: `${noExt}.avif`,
    webp: `${noExt}.webp`,
    fallback,
  };
};

const src = deriveFormats(img);
---

<div class="container">
  <div class="row gy-4 align-items-start">
    <!-- LEFT: Poster Image (flexible height/aspect) -->
    <div class="col-12 col-md-7">
      <figure class="poster-frame m-0">
        <img
          src={src.fallback}
          alt={name || "Poster image"}
          class="poster-img"
          loading="lazy"
          decoding="async"
        />
      </figure>
    </div>

    <!-- RIGHT: Details -->
    <div class="col-12 col-md-5">
      <div class="poster-meta">
        {name && <h2 class="poster-title mb-2">{name}</h2>}
        {idea && <p class="poster-idea mb-3"><strong>Idea:</strong> {idea}</p>}
        {date && <p class="poster-date mb-0"><strong>Date:</strong> {date}</p>}
      </div>
    </div>
  </div>
</div>

<style>
  /* Frame keeps a cohesive surface while allowing any aspect ratio */
  .poster-frame {
    background: #0a0a0a;
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
    padding: 8px;
  }

  /* Flexible image: no fixed height; natural aspect ratio */
  .poster-img {
    display: block;
    width: 100%;
    height: auto;
    border-radius: 6px;
    transition: transform .18s ease;
  }
  .poster-frame:hover .poster-img { transform: translateY(-1px); }

  .poster-meta { padding-inline: 4px; }
  .poster-title { line-height: 1.25; }
  .poster-idea  { line-height: 1.6; }
  .poster-date  { font-style: italic; color: #9aa1a6; }

  @media (max-width: 767.98px) {
    .poster-meta { padding-top: .25rem; }
  }
</style>
