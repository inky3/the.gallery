---
/**
 * Collection1.astro â€” same collage layout/animation with AVIF/WebP fallbacks
 * Props:
 *  - images: Array<{ src: string; title?: string }>
 *  - name?: string
 *  - info?: string
 */
const { images = [], name, info } = Astro.props;

const base = import.meta.env.BASE_URL || "/";
const resolve = (p?: string) =>
  p && /^https?:\/\//i.test(p) ? p : `${base}${String(p || "img/blank.jpg").replace(/^\/+/, "")}`;

const fmt = (p?: string) => {
  const fallback = resolve(p);
  const noExt = fallback.replace(/\.(avif|webp|jpe?g|png)$/i, "");
  return {
    avif: `${noExt}.avif`,
    webp: `${noExt}.webp`,
    fallback,
  };
};
---

<!-- Collage Section -->
<section class="collection">
  <div class="collage-wrapper">
    <div class="collage">
      {Array.from({ length: 9 }).map((_, i) => {
        const cfg = fmt(images[i]?.src);
        const alt = images[i]?.title || `Image ${i + 1}`;
        return (
          <div class={`item item-${i + 1} fade-in`} style={{ animationDelay: `${i * 0.2}s` }}>
            <picture>
              <source srcset={cfg.avif} type="image/avif" />
              <source srcset={cfg.webp} type="image/webp" />
              <img
                src={cfg.fallback}
                alt={alt}
                loading="lazy"
                decoding="async"
              />
            </picture>
          </div>
        );
      })}
    </div>
  </div>

  <!-- Text Below -->
  <div class="below-panel fade-in">
    {name && <h2>{name}</h2>}
    {info && <p>{info}</p>}
  </div>
</section>

<style>
  /* === Base Layout === */
  .collection {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-3, 24px);
  }

  .collage-wrapper {
    max-width: 1000px;
    width: 100%;
    padding: 20px;
  }

  .collage {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-template-rows: repeat(6, 120px);
    gap: 12px;
  }

  .item { overflow: hidden; border-radius: 8px; }
  .item img {
    width: 100%; height: 100%; object-fit: cover; display: block;
    transition: transform 0.3s ease;
  }
  .item img:hover { transform: scale(1.05); }

  /* === Animation === */
  .fade-in {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeRaise 0.8s ease forwards;
  }
  @keyframes fadeRaise {
    to { opacity: 1; transform: translateY(0); }
  }

  /* === Grid Placement === */
  .item-1 { grid-column: 1 / span 2; grid-row: 1 / span 2; }
  .item-2 { grid-column: 3 / span 1; grid-row: 1 / span 1; }
  .item-3 { grid-column: 4 / span 3; grid-row: 1 / span 1; }

  .item-4 { grid-column: 1 / span 3; grid-row: 3 / span 2; }
  .item-5 { grid-column: 4 / span 2; grid-row: 2 / span 3; }
  .item-6 { grid-column: 6 / span 1; grid-row: 3 / span 2; }

  .item-7 { grid-column: 1 / span 2; grid-row: 5 / span 2; }
  .item-8 { grid-column: 3 / span 2; grid-row: 5 / span 1; }
  .item-9 { grid-column: 5 / span 2; grid-row: 5 / span 2; }

  /* === Below Panel === */
  .below-panel {
    background: #f8f8f8;
    padding: 40px 50px;
    border-radius: 8px;
    text-align: center;
    max-width: 800px;
  }
  .below-panel h2 { margin-bottom: 0.5rem; }

  /* === Responsive === */
  @media (max-width: 768px) {
    .collage {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: auto;
    }
    .collage .item {
      grid-column: auto !important;
      grid-row: auto !important;
    }
    .below-panel { padding: 30px; }
  }
</style>
